<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Seznam – meeting otázky a poznámky</title>
  <meta name="description" content="Jednoduchá webová appka pro schůzkové otázky a poznámky. Ukládá se do prohlížeče (localStorage) a umí export do JSON/Markdown a tisk do PDF." />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>📝</text></svg>">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @media print { 
      .no-print { display: none !important; }
      .card { break-inside: avoid; }
      body { background: white; }
    }
    textarea { resize: vertical; }
  </style>
</head>
<body class="min-h-screen bg-slate-50 text-slate-900">
  <header class="sticky top-0 z-40 bg-white/90 backdrop-blur border-b border-slate-200">
    <div class="mx-auto max-w-4xl px-4 py-3 flex items-center gap-3">
      <div class="text-2xl">📝</div>
      <div>
        <h1 class="text-xl font-semibold">„Seznam“ – otázky a poznámky ze schůzky</h1>
      </div>
      <div class="ml-auto flex gap-2 no-print">
        <button id="btn-export-md" class="px-3 py-2 text-sm rounded-xl bg-slate-900 text-white hover:bg-slate-700">Export MD</button>
        <button id="btn-export-json" class="px-3 py-2 text-sm rounded-xl bg-slate-900 text-white hover:bg-slate-700">Export JSON</button>
        <button id="btn-print" class="px-3 py-2 text-sm rounded-xl bg-slate-900 text-white hover:bg-slate-700">Tisk / PDF</button>
      </div>
    </div>
  </header>

  <main class="mx-auto max-w-4xl px-4 py-6">
    <section class="mb-6 no-print sticky top-[72px] z-30">
      <div class="rounded-2xl border border-slate-200 bg-white p-4 shadow-sm">
        <div class="flex flex-wrap items-center gap-3">
          <div class="text-slate-700"><strong>Jméno respondenta:</strong></div>
          <input id="respondent" type="text" placeholder="např. Filip Ježek" class="flex-1 px-3 py-2 rounded-xl border border-slate-300 focus:outline-none focus:ring-2 focus:ring-slate-400" />
          <div class="ml-auto text-xs text-slate-500">Stav: <span id="save-state">uloženo</span></div>
        </div>
        <div class="mt-3 flex flex-wrap gap-2">
          <button id="btn-add" class="px-3 py-2 text-sm rounded-xl border border-slate-300 hover:bg-slate-50">➕ Přidat otázku</button>
          <button id="btn-reset-answers" class="px-3 py-2 text-sm rounded-xl border border-rose-300 text-rose-700 hover:bg-rose-50">🧹 Vyčistit odpovědi</button>
          <button id="btn-reset-all" class="px-3 py-2 text-sm rounded-xl border border-rose-400 text-rose-800 hover:bg-rose-50">♻️ Reset (vše)</button>
        </div>
      </div>
    </section>

    <section id="list" class="space-y-4"></section>
  </main>

  <template id="tpl-card">
    <article class="card rounded-2xl border border-slate-200 bg-white p-4 shadow-sm">
      <div class="flex items-start gap-3">
        <button class="handle mt-1 no-print shrink-0 px-2 py-1 text-slate-500 hover:text-slate-900" title="Přesun nahoru">⬆️</button>
        <button class="handle-down mt-1 no-print shrink-0 px-2 py-1 text-slate-500 hover:text-slate-900" title="Přesun dolů">⬇️</button>
        <div class="flex-1">
          <h2 contenteditable="true" class="q font-medium leading-6 focus:outline-none focus:ring-2 focus:ring-slate-300 rounded-md px-1">Otázka…</h2>
          <textarea class="a mt-3 w-full min-h-[120px] px-3 py-2 rounded-xl border border-slate-300 focus:outline-none focus:ring-2 focus:ring-slate-400" placeholder="Poznámky / odpovědi…"></textarea>
          <div class="mt-2 flex justify-between items-center text-xs text-slate-500">
            <span class="chars">0 znaků</span>
            <button class="btn-delete no-print px-2 py-1 rounded-lg border border-slate-300 hover:bg-slate-50">Smazat otázku</button>
          </div>
        </div>
      </div>
    </article>
  </template>

  <script>
    const STORAGE_KEY = 'seznam-questions-v1';
    const STORAGE_META = 'seznam-meta-v1';

    const defaultQuestions = [
      "Jestli si vybírá odvětví podle toho, co ho zajímá, nebo spíš podle příležitosti — tedy jestli rozhoduje to, jak se to vyplatí a jestli je to kvalitní a za dobrou cenu.",
      "Co tě přimělo začít?",
      "Jaké byly tvoje první chyby?",
      "Organizuješ si nějak čas? Píšeš si to, máš remindery na den, co máš udělat, nebo prostě víš, co máš ten den zvládnout a plníš to, jak můžeš?",
      "Co teď plánuješ dál — rozvíjet něco dalšího, nebo budeš rozvíjet to, co už máš?",
      "Co za nástroje používáš, které ti pomáhají?",
      "Byl jsi vždycky takový sympatický k lidem, nebo ses to musel naučit?",
      "Kam ty teď vlastně míříš?"
    ];

    const $list = document.getElementById('list');
    const $tpl = document.getElementById('tpl-card');
    const $respondent = document.getElementById('respondent');
    const $saveState = document.getElementById('save-state');

    const saveState = (text='uloženo') => { $saveState.textContent = text; };
    let saveTimer;

    function uid(){ return Math.random().toString(36).slice(2,9); }
    function nowISO(){ return new Date().toISOString(); }

    function loadData(){
      let data = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
      if(!data.length){
        data = defaultQuestions.map(q => ({ id: uid(), q, a: '' }));
      }
      const meta = JSON.parse(localStorage.getItem(STORAGE_META) || '{}');
      $respondent.value = meta.respondent || '';
      return data;
    }

    function saveData(data){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
      const meta = { respondent: $respondent.value, updatedAt: nowISO() };
      localStorage.setItem(STORAGE_META, JSON.stringify(meta));
      saveState('uloženo');
    }

    function scheduleSave(data){
      saveState('ukládám…');
      clearTimeout(saveTimer);
      saveTimer = setTimeout(() => saveData(data), 400);
    }

    let items = loadData();

    function render(){
      $list.innerHTML = '';
      items.forEach((item, index) => {
        const node = $tpl.content.firstElementChild.cloneNode(true);
        const qEl = node.querySelector('.q');
        const aEl = node.querySelector('.a');
        const charsEl = node.querySelector('.chars');
        const delBtn = node.querySelector('.btn-delete');
        const upBtn = node.querySelector('.handle');
        const downBtn = node.querySelector('.handle-down');

        qEl.textContent = item.q;
        aEl.value = item.a;
        charsEl.textContent = `${(item.a||'').length} znaků`;

        qEl.addEventListener('input', () => {
          item.q = qEl.textContent.trim();
          scheduleSave(items);
        });
        aEl.addEventListener('input', () => {
          item.a = aEl.value;
          charsEl.textContent = `${item.a.length} znaků`;
          scheduleSave(items);
        });
        delBtn.addEventListener('click', () => {
          if(confirm('Smazat tuto otázku?')){
            items.splice(index,1);
            saveData(items);
            render();
          }
        });
        upBtn.addEventListener('click', () => {
          if(index>0){
            [items[index-1], items[index]] = [items[index], items[index-1]];
            saveData(items);
            render();
          }
        });
        downBtn.addEventListener('click', () => {
          if(index < items.length-1){
            [items[index+1], items[index]] = [items[index], items[index+1]];
            saveData(items);
            render();
          }
        });

        $list.appendChild(node);
      });
    }

    render();

    document.getElementById('btn-add').addEventListener('click', () => {
      const q = prompt('Zadej text nové otázky:');
      if(q && q.trim()){
        items.push({ id: uid(), q: q.trim(), a: '' });
        saveData(items);
        render();
      }
    });

    document.getElementById('btn-reset-answers').addEventListener('click', () => {
      if(confirm('Vymazat všechny odpovědi? Otázky zůstanou.')){
        items = items.map(it => ({...it, a: ''}));
        saveData(items);
        render();
      }
    });

    document.getElementById('btn-reset-all').addEventListener('click', () => {
      if(confirm('Resetovat vše na výchozí otázky a vymazat odpovědi?')){
        localStorage.removeItem(STORAGE_KEY);
        localStorage.removeItem(STORAGE_META);
        items = loadData();
        render();
      }
    });

    $respondent.addEventListener('input', () => scheduleSave(items));

    function download(filename, text){
      const blob = new Blob([text], {type: 'text/plain;charset=utf-8'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = filename; a.click();
      URL.revokeObjectURL(url);
    }

    document.getElementById('btn-export-json').addEventListener('click', () => {
      const payload = {
        respondent: $respondent.value || null,
        updatedAt: new Date().toISOString(),
        items
      };
      download('seznam-notes.json', JSON.stringify(payload, null, 2));
    });

    document.getElementById('btn-export-md').addEventListener('click', () => {
      const lines = [
        `# Seznam – otázky a poznámky`,
        $respondent.value?`**Respondent:** ${$respondent.value}`:null,
        `**Exportováno:** ${new Date().toLocaleString()}`,
        '',
        ...items.map((it,i)=>`**${i+1}. ${it.q}**\n\n${it.a?it.a:'(bez odpovědi)'}\n`)
      ].filter(Boolean);
      download('seznam-notes.md', lines.join('\n'));
    });

    document.getElementById('btn-print').addEventListener('click', () => window.print());
  </script>
</body>
</html>

